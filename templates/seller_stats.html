{% extends "base.html" %}
{% block title %}Ø¢Ù…Ø§Ø± ÙØ±ÙˆØ´{% endblock %}
{% block content %}
<div class="container" style="margin-top:1.2rem;">
  <h2 style="text-align:center;margin-bottom:1rem;">Ø¢Ù…Ø§Ø± ÙØ±ÙˆØ´</h2>

  {% if summary %}
  <table class="cart-table" style="width:100%;max-width:700px;margin:auto;">
    <thead><tr><th>Ù…Ø­ØµÙˆÙ„</th><th>ØªØ¹Ø¯Ø§Ø¯ ÙØ±ÙˆØ®ØªÙ‡â€ŒØ´Ø¯Ù‡</th><th>Ù…Ø¨Ù„Øº Ú©Ù„</th></tr></thead>
    <tbody>
    {% for pid, name, qty, amount in summary %}
      <tr>
        <td>{{ name }}</td>
        <td class="qty-cell" data-pid="{{ pid }}" style="cursor:pointer;color:var(--primary);">
    {{ qty }}
</td>

        <td>{{ '{:,}'.format(amount) }} ØªÙˆÙ…Ø§Ù†</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  <!-- ==== Buyers Modal ==== -->
<div id="buyersOverlay" class="modal-overlay">
  <div class="modal" style="max-width:480px;">
    <button class="close-btn" id="buyersClose">âœ–</button>
    <h3 id="buyersTitle" style="text-align:center;margin-top:0;"></h3>
    <table class="cart-table" id="buyersTable" style="width:100%;margin-top:.6rem;">
      <thead><tr><th>Ø³ÙØ§Ø±Ø´#</th><th>Ú©Ø§Ø±Ø¨Ø±</th><th>ØªØ¹Ø¯Ø§Ø¯</th><th>ØªØ§Ø±ÛŒØ®</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

  {% else %}
    <p style="text-align:center;">Ù‡Ù†ÙˆØ² ÙØ±ÙˆØ´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ ğŸ˜´</p>
  {% endif %}
</div>

<script>
  const bOv   = document.getElementById('buyersOverlay');
const bTbl  = document.querySelector('#buyersTable tbody');
const bTit  = document.getElementById('buyersTitle');
document.getElementById('buyersClose').onclick=()=>bOv.classList.remove('show');
bOv.onclick=e=>{if(e.target===bOv) bOv.classList.remove('show');};

document.querySelectorAll('.qty-cell').forEach(cell=>{
  cell.addEventListener('click', async ()=>{
    const pid=cell.dataset.pid;
    bTit.textContent='â€¦ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ';
    bTbl.innerHTML='';
    bOv.classList.add('show');

    const res=await fetch(`/api/seller/product/${pid}/buyers`);
    if(!res.ok){ bTit.textContent='Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡'; return; }
    const data=await res.json();
    if(data.length===0){ bTit.textContent='Ù‡Ù†ÙˆØ² ÙØ±ÙˆØ´ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø­ØµÙˆÙ„ Ù†ÛŒØ³Øª'; return; }

    bTit.textContent=`Ø®Ø±ÛŒØ¯Ø§Ø±Ø§Ù† (Ù…Ø­ØµÙˆÙ„ #${pid})`;
    bTbl.innerHTML = data.map(row=>`
      <tr>
        <td>${row.order_id}</td>
        <td>${row.buyer}</td>
        <td>${row.qty}</td>
        <td>${row.date}</td>
      </tr>`).join('');
  });
});

</script>
{% endblock %}
